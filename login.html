<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login / Register</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-box { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; width: 300px; }
    .message { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Life Predictor</h1>

  <!-- Registration -->
  <div class="form-box">
    <h2>Register</h2>
    <input id="reg-name" placeholder="Name"><br><br>
    <input id="reg-email" type="email" placeholder="Email"><br><br>
    <input id="reg-pass" type="password" placeholder="Password"><br><br>
    <button onclick="register()">Register</button>
    <p id="register-msg"></p>
  </div>

  <!-- Login -->
  <div class="form-box">
    <h2>Login</h2>
    <input id="login-email" type="email" placeholder="Email"><br><br>
    <input id="login-pass" type="password" placeholder="Password"><br><br>
    <button onclick="login()">Login</button>
    <p id="login-msg"></p>
  </div>

<script>
// üîπ Detect API base
let API_BASE;
if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
  API_BASE = "http://127.0.0.1:8000";   // local dev
} else if (window.location.hostname.startsWith("192.168")) {
  // LAN IP for testing on mobile in same WiFi
  API_BASE = `http://${window.location.hostname}:8000`;
} else {
  API_BASE = "https://life-predictor.onrender.com"; // deployed backend
}

async function register() {
  const name = document.getElementById("reg-name").value;
  const email = document.getElementById("reg-email").value;
  const password = document.getElementById("reg-pass").value;
  const msg = document.getElementById("register-msg");

  msg.textContent = "Registering...";

  try {
    const res = await fetch(`${API_BASE}/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email, password })
    });

    const data = await res.json();
    if (res.ok) {
      msg.textContent = "‚úÖ Account created successfully! You can now login.";
      msg.className = "message";
    } else {
      msg.textContent = "‚ùå " + (data.detail || "Registration failed.");
      msg.className = "error";
    }
  } catch {
    msg.textContent = "‚ùå Network error.";
    msg.className = "error";
  }
}

async function login() {
  const email = document.getElementById("login-email").value;
  const password = document.getElementById("login-pass").value;
  const msg = document.getElementById("login-msg");

  msg.textContent = "Logging in...";

  try {
    const res = await fetch(`${API_BASE}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ username: email, password })
    });

    const data = await res.json();
    if (res.ok) {
      localStorage.setItem("token", data.access_token);
      msg.textContent = "‚úÖ Login successful! Redirecting...";
      msg.className = "message";
      setTimeout(() => window.location.href = "index.html", 1000);
    } else {
      msg.textContent = "‚ùå Invalid email or password.";
      msg.className = "error";S
    }
  } catch {
    msg.textContent = "‚ùå Network error.";
    msg.className = "error";
  }
}
</script>
</body>
</html>

