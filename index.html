<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Life Predictor - Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-box { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; width: 400px; }
    .message { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Life Predictor Dashboard</h1>
  <button onclick="logout()">Logout</button>
  <p id="welcome"></p>

  <!-- Prediction Form -->
  <div class="form-box">
    <h2>Submit Health Data</h2>
    <label>Age: <input id="age" type="number"></label><br><br>
    <label>BMI: <input id="bmi" type="number" step="0.1"></label><br><br>
    <label>Smoker (0/1): <input id="smoker" type="number"></label><br><br>
    <label>Stress Level: <input id="stress_level" type="number"></label><br><br>
    <label>Chronic Disease (0/1): <input id="chronic_disease" type="number"></label><br><br>
    <label>Diabetes (0/1): <input id="diabetes" type="number"></label><br><br>
    <label>Income Level: <input id="income_level" type="number"></label><br><br>
    <label>BP Systolic: <input id="bp_systolic" type="number"></label><br><br>
    <label>BP Diastolic: <input id="bp_diastolic" type="number"></label><br><br>
    <label>Vaccination Status (0/1): <input id="vaccination_status" type="number"></label><br><br>
    <label>Pollution Index: <input id="pollution_index" type="number"></label><br><br>
    <label>Sleep Hours: <input id="sleep_hours" type="number" step="0.1"></label><br><br>
    <label>Exercise Minutes: <input id="exercise_minutes" type="number"></label><br><br>
    <label>Alcohol Units: <input id="alcohol_units" type="number"></label><br><br>
    <label>Diet Quality: <input id="diet_quality" type="number"></label><br><br>
    <label>Work Hours: <input id="work_hours" type="number"></label><br><br>
    <label>Screen Time: <input id="screen_time" type="number"></label><br><br>
    <label>Social Activity: <input id="social_activity" type="number"></label><br><br>

    <button onclick="submitData()">Submit</button>
    <p id="prediction-msg"></p>
    <a id="pdf-link" style="display:none;" target="_blank">üìÑ Download PDF</a>
  </div>

<script>
const API_BASE = "https://life-predictor.onrender.com";
const token = localStorage.getItem("token");

if (!token) {
  window.location.href = "login.html";
}

document.getElementById("welcome").textContent = "Welcome! Submit your details below.";

function logout() {
  localStorage.removeItem("token");
  window.location.href = "login.html";
}

async function submitData() {
  const msg = document.getElementById("prediction-msg");
  msg.textContent = "Submitting...";

  const payload = {
    age: +document.getElementById("age").value,
    bmi: +document.getElementById("bmi").value,
    smoker: +document.getElementById("smoker").value,
    stress_level: +document.getElementById("stress_level").value,
    chronic_disease: +document.getElementById("chronic_disease").value,
    diabetes: +document.getElementById("diabetes").value,
    income_level: +document.getElementById("income_level").value,
    bp_systolic: +document.getElementById("bp_systolic").value,
    bp_diastolic: +document.getElementById("bp_diastolic").value,
    vaccination_status: +document.getElementById("vaccination_status").value,
    pollution_index: +document.getElementById("pollution_index").value,
    sleep_hours: +document.getElementById("sleep_hours").value,
    exercise_minutes: +document.getElementById("exercise_minutes").value,
    alcohol_units: +document.getElementById("alcohol_units").value,
    diet_quality: +document.getElementById("diet_quality").value,
    work_hours: +document.getElementById("work_hours").value,
    screen_time: +document.getElementById("screen_time").value,
    social_activity: +document.getElementById("social_activity").value,
  };

  try {
    const res = await fetch(`${API_BASE}/submit`, {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    if (res.ok) {
      msg.textContent = "‚úÖ Prediction: " + data.prediction;
      msg.className = "message";
      const link = document.getElementById("pdf-link");
      link.href = `${API_BASE}/download/${data.id}?token=${token}`;
      link.style.display = "inline";
    } else {
      msg.textContent = "‚ùå " + (data.detail || "Submission failed.");
      msg.className = "error";
    }
  } catch {
    msg.textContent = "‚ùå Network error.";
    msg.className = "error";
  }
}
</script>
</body>
</html>

