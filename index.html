<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Life Predictor - Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-box { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; width: 500px; }
    .message { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Life Predictor</h1>
  <button onclick="logout()">Logout</button>
  <p id="welcome"></p>

  <!-- Prediction Form -->
  <div class="form-box">
    <h2>Enter Your Details</h2>
    <input id="age" placeholder="Age"><br><br>
    <input id="bmi" placeholder="BMI"><br><br>
    <input id="smoker" placeholder="Smoker (0/1)"><br><br>
    <input id="stress_level" placeholder="Stress Level"><br><br>
    <input id="chronic_disease" placeholder="Chronic Disease (0/1)"><br><br>
    <input id="diabetes" placeholder="Diabetes (0/1)"><br><br>
    <input id="income_level" placeholder="Income Level"><br><br>
    <input id="bp_systolic" placeholder="BP Systolic"><br><br>
    <input id="bp_diastolic" placeholder="BP Diastolic"><br><br>
    <input id="vaccination_status" placeholder="Vaccination (0/1)"><br><br>
    <input id="pollution_index" placeholder="Pollution Index"><br><br>
    <input id="sleep_hours" placeholder="Sleep Hours"><br><br>
    <input id="exercise_minutes" placeholder="Exercise Minutes"><br><br>
    <input id="alcohol_units" placeholder="Alcohol Units"><br><br>
    <input id="diet_quality" placeholder="Diet Quality"><br><br>
    <input id="work_hours" placeholder="Work Hours"><br><br>
    <input id="screen_time" placeholder="Screen Time"><br><br>
    <input id="social_activity" placeholder="Social Activity"><br><br>

    <button onclick="submitData()">Submit</button>
    <p id="predict-msg"></p>
  </div>

<script>
// üîπ Detect API base automatically
let API_BASE;
if (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1") {
  API_BASE = "http://127.0.0.1:8000";   // local dev
} else if (window.location.hostname.startsWith("192.168")) {
  API_BASE = `http://${window.location.hostname}:8000`; // LAN IP (for mobile on same WiFi)
} else {
  API_BASE = "https://life-predictor.onrender.com"; // deployed backend
}

async function getUser() {
  const token = localStorage.getItem("token");
  if (!token) { window.location.href = "login.html"; return; }
  const res = await fetch(`${API_BASE}/me`, { headers: { "Authorization": `Bearer ${token}` } });
  if (!res.ok) { localStorage.removeItem("token"); window.location.href = "login.html"; return; }
  const data = await res.json();
  document.getElementById("welcome").textContent = "Welcome, " + data.name;
}

async function submitData() {
  const token = localStorage.getItem("token");
  const msg = document.getElementById("predict-msg");

  const payload = {
    age: +document.getElementById("age").value,
    bmi: +document.getElementById("bmi").value,
    smoker: +document.getElementById("smoker").value,
    stress_level: +document.getElementById("stress_level").value,
    chronic_disease: +document.getElementById("chronic_disease").value,
    diabetes: +document.getElementById("diabetes").value,
    income_level: +document.getElementById("income_level").value,
    bp_systolic: +document.getElementById("bp_systolic").value,
    bp_diastolic: +document.getElementById("bp_diastolic").value,
    vaccination_status: +document.getElementById("vaccination_status").value,
    pollution_index: +document.getElementById("pollution_index").value,
    sleep_hours: +document.getElementById("sleep_hours").value,
    exercise_minutes: +document.getElementById("exercise_minutes").value,
    alcohol_units: +document.getElementById("alcohol_units").value,
    diet_quality: +document.getElementById("diet_quality").value,
    work_hours: +document.getElementById("work_hours").value,
    screen_time: +document.getElementById("screen_time").value,
    social_activity: +document.getElementById("social_activity").value
  };

  try {
    const res = await fetch(`${API_BASE}/submit`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      const data = await res.json();
      msg.innerHTML = `‚úÖ Prediction: ${data.prediction} 
        | <a href="${API_BASE}/download/${data.id}" target="_blank">Download PDF</a>`;
      msg.className = "message";
    } else {
      msg.textContent = "‚ùå Submission failed.";
      msg.className = "error";
    }
  } catch (err) {
    msg.textContent = "‚ùå Network error.";
    msg.className = "error";
  }
}

function logout() {
  localStorage.removeItem("token");
  window.location.href = "login.html";
}

getUser();
</script>
</body>
</html>

