<!DOCTYPE html>
<html>
<head>
  <title>Life Predictor - Prediction</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    input, select { margin: 5px; padding: 5px; width: 250px; }
    button { margin: 10px; padding: 8px 15px; }
    .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
    .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Prediction Form</h1>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="section">
    <input id="age" type="number" placeholder="Age"><br>
    <input id="bmi" type="number" step="0.1" placeholder="BMI"><br>

    <label>Smoker:</label>
    <select id="smoker"><option value="0">No</option><option value="1">Yes</option></select><br>

    <input id="stress_level" type="number" placeholder="Stress Level (1-10)"><br>

    <label>Chronic Disease:</label>
    <select id="chronic_disease"><option value="0">No</option><option value="1">Yes</option></select><br>

    <label>Diabetes:</label>
    <select id="diabetes"><option value="0">No</option><option value="1">Yes</option></select><br>

    <input id="income_level" type="number" placeholder="Income Level (1-4)"><br>
    <input id="bp_systolic" type="number" placeholder="BP Systolic"><br>
    <input id="bp_diastolic" type="number" placeholder="BP Diastolic"><br>

    <label>Vaccination Status:</label>
    <select id="vaccination_status"><option value="0">Not up to date</option><option value="1">Up to date</option></select><br>

    <input id="pollution_index" type="number" placeholder="Pollution Index"><br>
    <input id="sleep_hours" type="number" step="0.1" placeholder="Sleep Hours"><br>
    <input id="exercise_minutes" type="number" placeholder="Exercise Minutes per Week"><br>
    <input id="alcohol_units" type="number" placeholder="Alcohol Units per Week"><br>
    <input id="diet_quality" type="number" placeholder="Diet Quality (1-10)"><br>
    <input id="work_hours" type="number" placeholder="Work Hours per Week"><br>
    <input id="screen_time" type="number" placeholder="Screen Time (hrs/day)"><br>
    <input id="social_activity" type="number" placeholder="Social Activity (days/week)"><br>

    <button onclick="submitPrediction()">Submit Prediction</button>

    <div id="result"></div>
  </div>

  <script>
    const API_BASE = "https://life-predictor.onrender.com";
    const userId = localStorage.getItem("user_id");

    if (!userId) {
      alert("You must login first!");
      window.location.href = "login.html";
    }

    function logout() {
      localStorage.removeItem("user_id");
      window.location.href = "login.html";
    }

    async function submitPrediction() {
      let url = `${API_BASE}/submit/?user_id=${userId}` +
        `&age=${age.value}&bmi=${bmi.value}&smoker=${smoker.value}` +
        `&stress_level=${stress_level.value}&chronic_disease=${chronic_disease.value}` +
        `&diabetes=${diabetes.value}&income_level=${income_level.value}` +
        `&bp_systolic=${bp_systolic.value}&bp_diastolic=${bp_diastolic.value}` +
        `&vaccination_status=${vaccination_status.value}&pollution_index=${pollution_index.value}` +
        `&sleep_hours=${sleep_hours.value}&exercise_minutes=${exercise_minutes.value}` +
        `&alcohol_units=${alcohol_units.value}&diet_quality=${diet_quality.value}` +
        `&work_hours=${work_hours.value}&screen_time=${screen_time.value}` +
        `&social_activity=${social_activity.value}`;

      let res = await fetch(url, {method:"POST"});
      let data = await res.json();
      if (data.prediction) {
        document.getElementById("result").innerHTML =
          `<h3>Prediction: ${data.prediction}</h3>
           <a href="${API_BASE}/download/${data.submission_id}" target="_blank">Download PDF</a>`;
      } else {
        alert("Prediction failed");
      }
    }
  </script>
</body>
</html>
